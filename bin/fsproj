#!/usr/bin/env perl
use strict;
use warnings;
use Main;
use Logic;
our $VERSION = 0.03;
our %stngs   = ();

sub RunMainLoop {
    foreach (%stngs) {
        print;
        print "\n";
    }

}

sub FSHelp {
    print <<EOF;

Crazy Fullscreen Detector & Screensaver Disabler
Version: $VERSION;

Copyright (C) 2012, Igor Gritsenko.
=================

Usage: fsproj [some options] <start|stop>

  Actions: 
start          Starts the script, if not started yet, and  sets the specified options.
stop           Stops the script. All parameters will be ignored.

If script runs without action, it suggests that user wanted to start.

  Options:
--help         This help text.
--no-gui       Do not use the GUI (Default).
--gui          Enable WxWidgets GUI.
--timeout sec  Set timeout in seconds.
--disable      Start script only, don't allow anything to do.
--enable       Start script and let him do work (Default).


EOF
    exit;

}

sub ARGVparse {
    $stngs{timeout} = 50;
    $stngs{GUI}     = 0;
    $stngs{state}   = 1;
    $stngs{act}     = "start";
    if ( defined @ARGV ) {
        $stngs{act} = pop @ARGV if ( $ARGV[-1] eq "start" || $ARGV[-1] eq "stop" );
        while (@ARGV) {
            my $param = shift @ARGV;
            if ( $param =~ s/^--// ) {
                &FSHelp if $param eq "help";
                if ( $param eq "timeout" ) {
                    $stngs{timeout} = shift @ARGV;
                    if ( $stngs{timeout} !~ /\d+/ ) {
                        unshift @ARGV, $stngs{timeout};
                        $stngs{timeout} = 50;
                    }

                    next;
                }
                if ( $param eq "no-gui" ) {
                    $stngs{GUI} = 0;
                    next;
                }
                if ( $param eq "gui" ) {
                    $stngs{GUI} = 1;
                    next;
                }

                if ( $param eq "disable" ) {
                    $stngs{state} = 0;
                    next;
                }
                if ( $param eq "enable" ) {
                    $stngs{state} = 1;
                    next;
                }

            }

        }
    }
}

&ARGVparse;
&RunMainLoop;
